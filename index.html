<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reading Fluency Analyzer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      line-height: 1.6;
    }
    textarea {
      width: 100%;
      height: 100px;
    }
    .word.correct {
      color: green;
      font-weight: bold;
    }
    .word.incorrect {
      color: red;
      font-weight: bold;
    }
    .results {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Reading Fluency Analyzer</h1>

  <label for="levelSelect">ğŸ§  CEFR ìˆ˜ì¤€ì„ ì„ íƒí•˜ì„¸ìš”:</label>
  <select id="levelSelect">
    <option value="A1">A1 - ì´ˆê¸‰</option>
    <option value="A2">A2 - ì´ˆì¤‘ê¸‰</option>
    <option value="B1">B1 - ì¤‘ê¸‰</option>
    <option value="B2">B2 - ì¤‘ìƒê¸‰</option>
    <option value="C1">C1 - ê³ ê¸‰</option>
    <option value="C2">C2 - ìµœìƒê¸‰</option>
  </select>

  <br /><br />
  <label for="textInput">ğŸ“ ì½ì„ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:</label>
  <textarea id="textInput">The quick brown fox jumps over the lazy dog.</textarea>

  <div>
    <button id="startBtn">Start Reading</button>
    <button id="stopBtn" disabled>Stop Reading</button>
  </div>

  <div class="results">
    <h2>ğŸ“£ ìŒì„± ì¸ì‹ ê²°ê³¼:</h2>
    <div id="outputText"></div>

    <h3>ğŸ“Š ë¶„ì„ ê²°ê³¼</h3>
    <p>ì½ì€ ì‹œê°„: <span id="duration"></span>ì´ˆ</p>
    <p>WPM: <span id="wpm"></span></p>
    <p>WCPM: <span id="wcpm"></span></p>
  </div>

  <script>
    const levelSelect = document.getElementById("levelSelect");
    const textInput = document.getElementById("textInput");
    const outputText = document.getElementById("outputText");
    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");
    const wpmDisplay = document.getElementById("wpm");
    const wcpmDisplay = document.getElementById("wcpm");
    const durationDisplay = document.getElementById("duration");

    const levelTexts = {
      A1: "My name is Tom. I like apples and bananas. I have a dog. It is small and white. I go to school every day.",
      A2: "Sally goes to the park every Sunday. She takes her bike and rides with her friends. After playing, they eat ice cream and talk about school.",
      B1: "David is planning a trip to London. He has never been there before, so he is very excited. He wants to visit museums, walk by the river, and try traditional English food.",
      B2: "Technology has changed how we live and work. Many people now use smartphones to check emails, attend meetings, and even do their shopping. This has made life more convenient, but also more stressful.",
      C1: "Climate change poses a serious threat to our planet. Rising temperatures, melting ice caps, and extreme weather events are becoming more common. Governments must take immediate action to reduce carbon emissions and invest in renewable energy.",
      C2: "Philosophical debates surrounding consciousness continue to challenge modern science. While some argue for a materialist perspective, others believe consciousness transcends physical explanation. These discussions not only shape our understanding of the mind, but also inform ethics, identity, and artificial intelligence."
    };

    levelSelect.onchange = () => {
      const selectedLevel = levelSelect.value;
      textInput.value = levelTexts[selectedLevel];
    };

    let recognition;
    let startTime, endTime;
    let transcript = "";

    if ("webkitSpeechRecognition" in window) {
      recognition = new webkitSpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = "en-US";

      recognition.onresult = function (event) {
        transcript = event.results[0][0].transcript;
        analyzeResults();
      };

      recognition.onerror = function (event) {
        alert("STT ì˜¤ë¥˜ ë°œìƒ: " + event.error);
      };
    } else {
      alert("Web Speech APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
    }

    startBtn.onclick = () => {
      startTime = new Date();
      recognition.start();
      startBtn.disabled = true;
      stopBtn.disabled = false;
      outputText.innerHTML = "ìŒì„± ì¸ì‹ ì¤‘...";
    };

    stopBtn.onclick = () => {
      endTime = new Date();
      recognition.stop();
      startBtn.disabled = false;
      stopBtn.disabled = true;
    };

    function analyzeResults() {
      const original = textInput.value.trim().split(/\s+/);
      const spoken = transcript.trim().split(/\s+/);

      let correct = 0;
      const result = original.map((word, i) => {
        const spokenWord = spoken[i] || "";
        const match = word.toLowerCase() === spokenWord.toLowerCase();
        if (match) correct++;
        return `<span class="word ${match ? "correct" : "incorrect"}">${word}</span>`;
      });

      outputText.innerHTML = result.join(" ");

      const duration = (endTime - startTime) / 1000;
      const totalWords = spoken.length;

      const wpm = (totalWords / duration) * 60;
      const wcpm = (correct / duration) * 60;

      durationDisplay.textContent = duration.toFixed(1);
      wpmDisplay.textContent = wpm.toFixed(1);
      wcpmDisplay.textContent = wcpm.toFixed(1);
    }
  </script>
</body>
</html>
